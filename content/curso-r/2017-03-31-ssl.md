+++
title = "Requisições seguras"
date = "2017-03-31"
categories = ["curso-r"]
+++

<div><p class="text-muted text-uppercase mb-small text-right"> Por <a href="http://curso-r.com/author/julio">Julio</a> 31/03/2017 </p><div id="post-content"> <p>No mundo do web scraping, muitas vezes precisamos acessar sites <code>HTTPS</code>, a vers&#xE3;o <code>S</code>egura do <code>HTTP</code> (Hyper Text Transfer Protocol). Esse protocolo &#xE9; utilizado para encriptar as mensagens trocadas por usu&#xE1;rio e servidor.</p>
<p>O pacote <code>httr</code> utiliza um padr&#xE3;o <code>SSL</code> (Secure Sockets Layer) para lidar com <code>HTTPS</code>. O SSL nada mais &#xE9; que uma forma de informar ao servidor que voc&#xEA; &#xE9; voc&#xEA;, garantindo que suas mensagens s&#xF3; possam ser interpretadas por esse servidor, e vice-versa. O padr&#xE3;o do <code>httr</code> funciona bem para a maioria dos sites, permitindo o acesso sem sofrimento.</p>
<p>No entanto, alguns sites d&#xE3;o o seguinte erro:</p>
<pre class="r"><code>httr::GET(&quot;https://esaj.tjsp.jus.br&quot;)
## Error in curl::curl_fetch_memory(url, handle = handle): Peer certificate cannot be authenticated with given CA certificates</code></pre>
<p>A solu&#xE7;&#xE3;o para esse problema &#xE9; bem simples. Basta mandar o <code>httr</code> ignorar o protocolo <code>SSL</code> usando a fun&#xE7;&#xE3;o <code>httr::config()</code>. Ignorar o SSL costuma ser uma m&#xE1; ideia, pois faz com que as mensagens entre usu&#xE1;rio e servidor voltem a ser em texto puro, como se fosse <code>HTTP</code>. Mas no web scraping isso n&#xE3;o &#xE9; exatamente um problema.</p>
<p>Para solucionar o problema acima, rode:</p>
<pre class="r"><code>httr::GET(&quot;https://esaj.tjsp.jus.br&quot;, httr::config(ssl_verifypeer = FALSE))
## Response [https://esaj.tjsp.jus.br/esaj/portal.do?servico=740000]
## Date: 2017-06-10 22:50
## Status: 200
## Content-Type: text/html;charset=ISO-8859-1
## Size: 37.7 kB
## ## ## ## ## ## ## ## ## &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://w...
## ## ...</code></pre>
<p>E&#x2026; Feliz web scraping!</p>
<p><strong>OBS:</strong> Certa vez um amigo teve problema com SSL mesmo tentando a solu&#xE7;&#xE3;o acima numa m&#xE1;quina com Ubuntu Resolvemos o problema reinstalando a biblioteca <code>libcurl4-openssl-dev</code> via <code>apt-get</code> e o pacote <code>curl</code> do R. Assim:</p>
<p>No terminal:</p>
<pre class="shell"><code>sudo apt-get update
sudo apt-get install libcurl4-openssl-dev</code></pre>
<p>No R:</p>
<pre class="r"><code>install.packages(&apos;curl&apos;)</code></pre> </div></div>
