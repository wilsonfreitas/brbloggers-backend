+++
title = "Medidas-resumo no tidyverse"
date = "2017-03-11 11:07:31"
categories = ["curso-r"]
+++

<div><p class="text-muted text-uppercase mb-small text-right"> Por <a href="http://curso-r.com/author/julio">Julio</a> 11/03/2017 </p><div id="post-content"> <p>Hoje estava fazendo uma an&#xE1;lise explorat&#xF3;ria e precisava estudar os quartis de uma vari&#xE1;vel cont&#xED;nua. A solu&#xE7;&#xE3;o usando o <code>tidyverse</code> &#xE9; t&#xE3;o elegante que valeu um post no blog.</p>
<p>Usaremos os pacotes <code>tibble</code>, <code>dplyr</code>, <code>tidyr</code> e <code>purrr</code>:</p>
<pre class="r"><code>library(tibble)
library(dplyr)
library(tidyr)
library(purrr)</code></pre>
<p>Nesse exemplo, usamos a famosa base <code>mtcars</code></p>
<pre class="r"><code>tab &lt;- mtcars %&gt;% group_by(am, vs) %&gt;% nest() %&gt;% mutate(quartis = map(data, ~enframe(quantile(.x$mpg, 1:3 / 4)))) %&gt;% unnest(quartis) %&gt;% spread(name, value)
tab
## # A tibble: 4 x 5
## am vs `25%` `50%` `75%`
## * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0 0 14.050 15.20 16.625
## 2 0 1 18.650 21.40 22.150
## 3 1 0 16.775 20.35 21.000
## 4 1 1 25.050 30.40 31.400</code></pre>
<ul>
<li>A fun&#xE7;&#xE3;o <code>dplyr::group_by()</code> faz um grupo para cada combina&#xE7;&#xE3;o de <code>am</code> e <code>vs</code>.</li>
<li>A fun&#xE7;&#xE3;o <code>tidyr::nest()</code> guarda os dados de cada grupo numa <em>list-column</em> chamada <code>data</code>.</li>
<li>A fun&#xE7;&#xE3;o <code>purrr::map()</code> aplica elegantemente a fun&#xE7;&#xE3;o <code>quantile()</code> para cada grupo de datas, sendo ajudada pela fun&#xE7;&#xE3;o <code>tibble::enframe()</code>, que coloca o resultado de <code>quantile()</code> em uma <code>tibble</code>.</li>
<li>A fun&#xE7;&#xE3;o <code>tidyr::unnest()</code> coloca os resultados de volta em colunas-vetores.</li>
<li>Terminamos com <code>tidyr::spread()</code> para espalhar os quartis nas colunas.</li>
</ul>
<p>O resultado pode ser jogado diretamente numa tabela:</p>
<pre class="r"><code>knitr::kable(tab)</code></pre>
<table>
<thead> </thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>14.050</td>
<td>15.20</td>
<td>16.625</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>18.650</td>
<td>21.40</td>
<td>22.150</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>16.775</td>
<td>20.35</td>
<td>21.000</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>25.050</td>
<td>30.40</td>
<td>31.400</td>
</tr>
</tbody>
</table>
<p>&#xC9; poss&#xED;vel mudar esse c&#xF3;digo para ter outras medidas-resumo, por exemplo. Para isso, podemos usar a fun&#xE7;&#xE3;o <code>summary()</code>, por exemplo, ou criar nossa pr&#xF3;pria fun&#xE7;&#xE3;o.</p>
<pre class="r"><code>mtcars %&gt;% group_by(am, vs) %&gt;% nest() %&gt;% mutate(s = map(data, ~enframe(summary(.x$mpg)))) %&gt;% unnest(s) %&gt;% spread(name, value) %&gt;% knitr::kable()</code></pre>
<table>
<thead> </thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>14.050</td>
<td>16.625</td>
<td>19.2</td>
<td>15.05000</td>
<td>15.20</td>
<td>10.4</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>18.650</td>
<td>22.150</td>
<td>24.4</td>
<td>20.74286</td>
<td>21.40</td>
<td>17.8</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>16.775</td>
<td>21.000</td>
<td>26.0</td>
<td>19.75000</td>
<td>20.35</td>
<td>15.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>25.050</td>
<td>31.400</td>
<td>33.9</td>
<td>28.37143</td>
<td>30.40</td>
<td>21.4</td>
</tr>
</tbody>
</table>
<p>Como voc&#xEA; resolveria essa task? Escreva nos coment&#xE1;rios!</p>
<p><strong>OBS</strong>: Outra solu&#xE7;&#xE3;o para a mesma task, mais concisa, usando <code>dplyr::do()</code>:</p>
<pre class="r"><code>mtcars %&gt;% group_by(am, vs) %&gt;% do(enframe(summary(.$mpg))) %&gt;% spread(name, value) %&gt;% knitr::kable()</code></pre>
<table>
<thead> </thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>14.050</td>
<td>16.625</td>
<td>19.2</td>
<td>15.05000</td>
<td>15.20</td>
<td>10.4</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>18.650</td>
<td>22.150</td>
<td>24.4</td>
<td>20.74286</td>
<td>21.40</td>
<td>17.8</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>16.775</td>
<td>21.000</td>
<td>26.0</td>
<td>19.75000</td>
<td>20.35</td>
<td>15.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>25.050</td>
<td>31.400</td>
<td>33.9</td>
<td>28.37143</td>
<td>30.40</td>
<td>21.4</td>
</tr>
</tbody>
</table>
<p>Mas: tome cuidado! Se o Hadley diz&#x2026;</p>
<div class="figure">
<img src="http://lsru.github.io/r_workshop/img/purrr_do.png" alt=""> </div> </div></div>
